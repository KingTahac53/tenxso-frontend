<main class="2xl:ml-[--w-side] xl:ml-[--w-side-md] md:ml-[--w-side-small]">
  <div class="main__inner">
    <div class="flex max-lg:flex-col xl:gap-10 md:gap-3" id="js-oversized">
      <div class="md:max-w-[510px] mx-auto flex-1 xl:space-y-6 space-y-3">
        <!-- Loop through each feed -->
        <div *ngFor="let feed of feeds" class="bg-white rounded-xl shadow-sm text-sm font-medium border dark:bg-dark2">
          <!-- Feed Header -->
          <div class="flex gap-3 sm:p-4 p-2.5 text-sm font-medium">
            <img [src]="feed.authorProfilePic || 'assets/images/default-avatar.jpg'" alt="Profile Picture"
              class="w-9 h-9 rounded-full">
            <div class="flex-1">
              <h4 class="text-black dark:text-white">{{ feed.authorUsername }}</h4>
              <div class="text-xs text-gray-500 dark:text-white/80">
                {{ feed.createdAt || '2 hours ago' }}
              </div>
            </div>
            <div class="-mr-1 relative">
              <button type="button" class="button__ico w-8 h-8">
                <ion-icon class="text-xl" name="ellipsis-horizontal"></ion-icon>
              </button>
              <div class="absolute right-0 mt-2 w-[245px]"
                uk-dropdown="pos: bottom-right; animation: uk-animation-scale-up uk-transform-origin-top-right; animate-out: true; mode: click">
                <nav class="flex flex-col space-y-2 p-2">
                  <a href="#" (click)="downloadFile(feed.content)"
                    class="flex items-center gap-2 hover:bg-gray-100 p-2 rounded">
                    <ion-icon class="text-xl" name="bookmark-outline"></ion-icon>
                    Download
                  </a>
                  <a href="#" (click)="goToChatBox(feed)" class="flex items-center gap-2 hover:bg-gray-100 p-2 rounded">
                    <ion-icon class="text-xl" name="paper-plane-outline"></ion-icon>
                    Message
                  </a>
                  <hr>
                  <a href="#" (click)="reportFeed(feed)"
                    class="flex items-center gap-2 text-red-400 hover:bg-red-50 dark:hover:bg-red-500/50 p-2 rounded">
                    <ion-icon class="text-xl" name="flag-outline"></ion-icon>
                    Report
                  </a>
                </nav>
              </div>
            </div>
          </div>

          <!-- Feed Content -->
          <div class="relative w-full lg:h-72 h-full sm:px-4">
            <ng-container *ngIf="isVideo(feed.content); else notVideo">
              <app-video-player [src]="feed.content" [poster]="feed.thumbnail || '/assets/default-video-poster.jpg'"
                [muted]="true" [loop]="true" class="w-full h-full"></app-video-player>
            </ng-container>
            <ng-template #notVideo>
              <img [src]="feed.content" alt="Feed Content" class="sm:rounded-lg w-full h-full object-cover">
            </ng-template>
          </div>

          <!-- Feed Actions -->
          <div class="sm:p-4 p-2.5 flex items-center gap-4 text-xs font-semibold">
            <div class="flex items-center gap-2.5">
              <button type="button" (click)="likePost(feed)"
                [ngClass]="feed.likeFlag == 0 ? 'text-red-500 bg-red-100 dark:bg-slate-700' : 'text-red-500 bg-red-200 dark:bg-slate-600'"
                class="button__ico p-1 rounded-full">
                <ion-icon class="text-lg" name="heart"></ion-icon>
              </button>
              <span>{{ feed.likeCount || 0 }}</span>
            </div>
            <div class="flex items-center gap-3">
              <button type="button" class="button__ico bg-slate-200/70 dark:bg-slate-700 p-1 rounded-full"
                (click)="toggleComments(feed)">
                <ion-icon class="text-lg" name="chatbubble-ellipses"></ion-icon>
              </button>
              <span>{{ feed.commentCount || 0 }}</span>
            </div>
          </div>

          <!-- Inline Comments Section -->
          <div *ngIf="feed.showComments"
            class="sm:p-4 p-2.5 border-t border-gray-100 font-normal space-y-3 dark:border-slate-700/40">
            <!-- List comments -->
            <div *ngFor="let comment of feed.comments" class="flex items-start gap-3">
              <img [src]="comment.userProfileUrl || 'assets/images/default-avatar.jpg'" alt="Commenter"
                class="w-6 h-6 mt-1 rounded-full">
              <div class="flex-1">
                <a href="#" class="text-black font-medium dark:text-white">{{ comment.commentAuthorUsername }}</a>
                <p class="mt-0.5 text-sm">{{ comment.commentContent }}</p>
                <div class="text-xs text-gray-500">{{ comment.commentDateCreated }}</div>
              </div>
            </div>
            <!-- Add Comment Input -->
            <div
              class="sm:px-4 sm:py-3 p-2.5 border-t border-gray-100 flex items-center gap-1 dark:border-slate-700/40">
              <img [src]="feed.currentUserProfilePic || 'assets/images/default-avatar.jpg'" alt="Your Avatar"
                class="w-6 h-6 rounded-full">
              <div class="flex-1 relative overflow-hidden h-10">
                <textarea placeholder="Add a comment...." rows="1"
                  class="w-full resize-none bg-transparent px-4 py-2 focus:outline-none"
                  [(ngModel)]="feed.newComment"></textarea>
              </div>
              <button type="button" (click)="postComment(feed)"
                class="text-sm rounded-full py-1.5 px-3.5 bg-secondary text-white">
                Save
              </button>
            </div>
          </div>
        </div>

        <!-- Loader -->
        <div *ngIf="loading" class="rounded-xl shadow-sm p-4 space-y-4 bg-slate-200/40 animate-pulse dark:bg-dark2">
          <div class="flex gap-3">
            <div class="w-9 h-9 rounded-full bg-slate-300/20"></div>
            <div class="flex-1 space-y-3">
              <div class="w-40 h-5 rounded-md bg-slate-300/20"></div>
              <div class="w-24 h-4 rounded-md bg-slate-300/20"></div>
            </div>
            <div class="w-6 h-6 rounded-full bg-slate-300/20"></div>
          </div>
          <div class="w-full h-52 rounded-lg bg-slate-300/10 my-3"></div>
          <div class="flex gap-3">
            <div class="w-16 h-5 rounded-md bg-slate-300/20"></div>
            <div class="w-14 h-5 rounded-md bg-slate-300/20"></div>
            <div class="w-6 h-6 rounded-full bg-slate-300/20 ml-auto"></div>
            <div class="w-6 h-6 rounded-full bg-slate-300/20"></div>
          </div>
        </div>
        <div *ngIf="allFeedsLoaded" class="text-center py-4 text-gray-500">
          All Feeds Loaded
        </div>
      </div>
    </div>
  </div>
</main>